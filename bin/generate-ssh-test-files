#!/usr/bin/env bash

set -euo pipefail

tmp=tmp/ssh-test

rm -rf $tmp
mkdir -p $tmp

package=$tmp/package

mkdir -p $package

cargo run --release create $package

cargo run --release message --output $tmp/message $package

key_path=$tmp/id_ed25519

ssh-keygen -t ed25519 -f $key_path -N "" -q

ssh-keygen -Y sign -f $key_path -n filepack $tmp/message

static=static/ssh-test
rm -rf $static
mkdir -p $static

cp \
  $tmp/message \
  $tmp/message.sig \
  $tmp/id_ed25519 \
  $tmp/id_ed25519.pub \
  $static
